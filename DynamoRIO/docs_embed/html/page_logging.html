---
title: "Logging"
layout: default
permalink: /page_logging.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Logging </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes some of the useful information available in DR's logfiles. See also <a class="el" href="page_debugging.html">the general page on debugging</a>.</p>
<h1><a class="anchor" id="autotoc_md201"></a>
Enabling Logging</h1>
<p>Logging can be enabled with the <a class="el" href="page_deploy.html#op_loglevel">`-loglevel` runtime option</a> in a debug build. A number specifies the logging level. For example:</p>
<div class="fragment"><div class="line">% bin64/drrun -debug -loglevel 2 -- ls</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md202"></a>
Log Directories and Files</h1>
<p>Logs are written to the <code>logs/</code> subdirectory of the DR install or build directory. A new subdirectory is created for each process, with a name composed of the executable name, the process id, and an instance number to ensure that it is unique. This directory name is reported at the start of the run:</p>
<div class="fragment"><div class="line">% bin64/drrun -debug -loglevel 2 -c samples/bin64/libopcodes.so -- ls</div>
<div class="line">&lt;log dir=/work/dr/git/exports/bin64/../logs/ls.4611.00000000&gt;</div>
<div class="line">&lt;Starting application /usr/bin/ls (4611)&gt;</div>
<div class="line">...</div>
</div><!-- fragment --><p>Within the log directory for a process, there is a single process-wide file and a separate file for each thread. Log messages are typically sent to the executing thread's file, but events that affect the whole process are sent to the process log file instead. The process file's name is similar to the directory name. The thread file names start with <code>log</code> followed by the sequential number of the thread and then the thread id. For example:</p>
<div class="fragment"><div class="line">% ls /work/dr/git/exports/bin64/../logs/ls.4611.00000000</div>
<div class="line">log.0.4611.html  ls.0.4611.html</div>
</div><!-- fragment --><p>The files are named with the <code>.html</code> for historical reasons, to make it easy to open via double-clicking on a Windows machine. They are not really in HTML format but are plain text.</p>
<h1><a class="anchor" id="autotoc_md203"></a>
Fragments</h1>
<p>A <em>fragment</em> is a unit of code executed in the code cache, with a single entry and multiple exits. A fragment is either a dynamic basic block or a trace.</p>
<h1><a class="anchor" id="autotoc_md204"></a>
Loglevel 2</h1>
<p>At <code>-loglevel 2</code>, a thread log file prints the start address of each fragment created as well as the entries and exits from the cache. Fragments that are linked or indirect branch lookup hits stay within the cache and such transitions do not show up in the log.</p>
<p>For example:</p>
<div class="fragment"><div class="line">dispatch: target = 0x00007f9c9ba10b80</div>
<div class="line">Entry into F1581(0x00007f9c9ba10b80).0x0000000049b69ba8 (shared)</div>
<div class="line">Exit from sourceless ibl: bb jmp*</div>
<div class="line"> (target 0x00007f9c9b016900 in cache but not lookup table)</div>
<div class="line"> </div>
<div class="line">dispatch: target = 0x00007f9c9b016900</div>
<div class="line">Entry into F3826(0x00007f9c9b016900).0x0000000049bbc1d0 (shared)</div>
<div class="line">Exit from F3836(0x00007f9c9b0edb69).0x0000000049bbc346 (shared)</div>
<div class="line"> (cannot link F3836-&gt;F3837) (target F3837 is trace head)</div>
<div class="line"> </div>
<div class="line">dispatch: target = 0x00007f9c9b0edb60</div>
<div class="line">Entry into F3837(0x00007f9c9b0edb60).0x0000000049bbc35c (trace head)(shared)</div>
<div class="line">Exit from sourceless ibl: bb ret</div>
<div class="line"> (target 0x00007f9c9b3a0033 not in cache)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md205"></a>
Loglevel 3</h1>
<p>At <code>loglevel 3</code>, details of the instructions that are processed to create each fragment are given. First, the instructions decoded from application code by the "interpreter" are listed:</p>
<div class="fragment"><div class="line">dispatch: target = 0x00007fbd5cfb2b10</div>
<div class="line"> </div>
<div class="line">interp: start_pc = 0x00007fbd5cfb2b10</div>
<div class="line">  0x00007fbd5cfb2b10  4c 89 d9             mov    %r11 -&gt; %rcx</div>
<div class="line">  0x00007fbd5cfb2b13  48 29 c1             sub    %rax %rcx -&gt; %rcx</div>
<div class="line">  0x00007fbd5cfb2b16  48 83 f9 0b          cmp    %rcx $0x000000000000000b</div>
<div class="line">  0x00007fbd5cfb2b1a  77 14                jnbe   $0x00007fbd5cfb2b30</div>
<div class="line">end_pc = 0x00007fbd5cfb2b1c</div>
</div><!-- fragment --><p>Next, the intructions are listed in DR's IR format as they are passed to the client. The first column in an instruction list printout shows the offset in bytes from the start of the list if the instructions were to be encoded as-is. The second column identifies the type of instruction: typically either <code>L3</code> for an unmodified application instruction or <code>m4</code> for a client-added tool instruction:</p>
<div class="fragment"><div class="line">instrument_basic_block ******************</div>
<div class="line"> </div>
<div class="line">before instrumentation:</div>
<div class="line">TAG  0x00007fbd5cfb2b10</div>
<div class="line"> +0    L3                      4c 89 d9             mov    %r11 -&gt; %rcx</div>
<div class="line"> +3    L3                      48 29 c1             sub    %rax %rcx -&gt; %rcx</div>
<div class="line"> +6    L3                      48 83 f9 0b          cmp    %rcx $0x000000000000000b</div>
<div class="line"> +10   L3                      77 14                jnbe   $0x00007fbd5cfb2b30</div>
<div class="line">END 0x00007fbd5cfb2b10</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">after instrumentation:</div>
<div class="line">TAG  0x00007fbd5cfb2b10</div>
<div class="line"> +0    m4 @0x0000000048850840  f0 81 05 61 90 7b 29 lock add    $0x00000001 &lt;rel&gt; 0x000000007200396c[4byte] -&gt; &lt;rel&gt; 0x000000007200396c[4byte]</div>
<div class="line">                               01 00 00 00</div>
<div class="line"> +11   m4 @0x0000000048850c28  f0 81 05 a9 8f 7b 29 lock add    $0x00000001 &lt;rel&gt; 0x00000000720038b4[4byte] -&gt; &lt;rel&gt; 0x00000000720038b4[4byte]</div>
<div class="line">                               01 00 00 00</div>
<div class="line"> +22   m4 @0x000000004884d8c0  f0 81 05 b9 8f 7b 29 lock add    $0x00000001 &lt;rel&gt; 0x00000000720038c4[4byte] -&gt; &lt;rel&gt; 0x00000000720038c4[4byte]</div>
<div class="line">                               01 00 00 00</div>
<div class="line"> +33   m4 @0x000000004884e868  f0 81 05 05 90 7b 29 lock add    $0x00000001 &lt;rel&gt; 0x0000000072003910[4byte] -&gt; &lt;rel&gt; 0x0000000072003910[4byte]</div>
<div class="line">                               01 00 00 00</div>
<div class="line"> +44   L3                      4c 89 d9             mov    %r11 -&gt; %rcx</div>
<div class="line"> +47   L3                      48 29 c1             sub    %rax %rcx -&gt; %rcx</div>
<div class="line"> +50   L3                      48 83 f9 0b          cmp    %rcx $0x000000000000000b</div>
<div class="line"> +54   L3                      77 14                jnbe   $0x00007fbd5cfb2b30</div>
<div class="line">END 0x00007fbd5cfb2b10</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md206"></a>
Loglevel 4</h1>
<p>At <code>-loglevel 4</code>, the mangling performed by DR is visible as the precise code layout encoded in the code cache is shown:</p>
<div class="fragment"><div class="line">interp: start_pc = 0x00007fbff7a2ccb2</div>
<div class="line">  0x00007fbff7a2ccb2  f3 c3                ret    %rsp (%rsp)[8byte] -&gt; %rsp</div>
<div class="line">mbr exit target = 0x00000000516af500</div>
<div class="line">end_pc = 0x00007fbff7a2ccb4</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">instrument_basic_block ******************</div>
<div class="line"> </div>
<div class="line">before instrumentation:</div>
<div class="line">TAG  0x00007fbff7a2ccb2</div>
<div class="line"> +0    L3                      f3 c3                ret    %rsp (%rsp)[8byte] -&gt; %rsp</div>
<div class="line">END 0x00007fbff7a2ccb2</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">after instrumentation:</div>
<div class="line">TAG  0x00007fbff7a2ccb2</div>
<div class="line"> +0    m4 @0x000000005171dd38  65 48 a3 18 00 00 00 mov    %rax -&gt; %gs:0x18[8byte]</div>
<div class="line">                               00 00 00 00</div>
<div class="line"> +11   m4 @0x000000005171e1e8  9f                   lahf    -&gt; %ah</div>
<div class="line"> +12   m4 @0x000000005171db40  0f 90 c0             seto    -&gt; %al</div>
<div class="line"> +15   m4 @0x0000000051765b50  f0 81 05 99 90 8e 20 lock add    $0x00000001 &lt;rel&gt; 0x00000000720039a4[4byte] -&gt; &lt;rel&gt; 0x00000000720039a4[4byte]</div>
<div class="line">                               01 00 00 00</div>
<div class="line"> +26   m4 @0x000000005171eb08                       &lt;label&gt;</div>
<div class="line"> +26   m4 @0x0000000051765bd0  04 7f                add    $0x7f %al -&gt; %al</div>
<div class="line"> +28   m4 @0x000000005171e8e8  9e                   sahf   %ah</div>
<div class="line"> +29   m4 @0x000000005171dc40  65 48 a1 18 00 00 00 mov    %gs:0x18[8byte] -&gt; %rax</div>
<div class="line">                               00 00 00 00</div>
<div class="line"> +40   m4 @0x0000000051765800                       &lt;label&gt;</div>
<div class="line"> +40   L3                      f3 c3                ret    %rsp (%rsp)[8byte] -&gt; %rsp</div>
<div class="line">END 0x00007fbff7a2ccb2</div>
<div class="line"> </div>
<div class="line">bb ilist before mangling:</div>
<div class="line">TAG  0x00007fbff7a2ccb2</div>
<div class="line"> +0    m4 @0x000000005171dd38  65 48 a3 18 00 00 00 mov    %rax -&gt; %gs:0x18[8byte]</div>
<div class="line">                               00 00 00 00</div>
<div class="line"> +11   m4 @0x000000005171e1e8  9f                   lahf    -&gt; %ah</div>
<div class="line"> +12   m4 @0x000000005171db40  0f 90 c0             seto    -&gt; %al</div>
<div class="line"> +15   m4 @0x0000000051765b50  f0 81 05 99 8f 8e 20 lock add    $0x00000001 &lt;rel&gt; 0x00000000720039a4[4byte] -&gt; &lt;rel&gt; 0x00000000720039a4[4byte]</div>
<div class="line">                               01 00 00 00</div>
<div class="line"> +26   m4 @0x000000005171eb08                       &lt;label&gt;</div>
<div class="line"> +26   m4 @0x0000000051765bd0  04 7f                add    $0x7f %al -&gt; %al</div>
<div class="line"> +28   m4 @0x000000005171e8e8  9e                   sahf   %ah</div>
<div class="line"> +29   m4 @0x000000005171dc40  65 48 a1 18 00 00 00 mov    %gs:0x18[8byte] -&gt; %rax</div>
<div class="line">                               00 00 00 00</div>
<div class="line"> +40   m4 @0x0000000051765800                       &lt;label&gt;</div>
<div class="line"> +40   L3                      f3 c3                ret    %rsp (%rsp)[8byte] -&gt; %rsp</div>
<div class="line"> +42   L4 @0x00000000517205f8  e9 fb 4a f9 ff       jmp    $0x00000000516af500 &lt;shared_bb_ibl_ret&gt;</div>
<div class="line">END 0x00007fbff7a2ccb2</div>
<div class="line"> </div>
<div class="line">bb ilist after mangling:</div>
<div class="line">TAG  0x00007fbff7a2ccb2</div>
<div class="line"> +0    m4 @0x000000005171dd38  65 48 a3 18 00 00 00 mov    %rax -&gt; %gs:0x18[8byte]</div>
<div class="line">                               00 00 00 00</div>
<div class="line"> +11   m4 @0x000000005171e1e8  9f                   lahf    -&gt; %ah</div>
<div class="line"> +12   m4 @0x000000005171db40  0f 90 c0             seto    -&gt; %al</div>
<div class="line"> +15   m4 @0x0000000051765b50  f0 81 05 99 8f 8e 20 lock add    $0x00000001 &lt;rel&gt; 0x00000000720039a4[4byte] -&gt; &lt;rel&gt; 0x00000000720039a4[4byte]</div>
<div class="line">                               01 00 00 00</div>
<div class="line"> +26   m4 @0x000000005171eb08                       &lt;label&gt;</div>
<div class="line"> +26   m4 @0x0000000051765bd0  04 7f                add    $0x7f %al -&gt; %al</div>
<div class="line"> +28   m4 @0x000000005171e8e8  9e                   sahf   %ah</div>
<div class="line"> +29   m4 @0x000000005171dc40  65 48 a1 18 00 00 00 mov    %gs:0x18[8byte] -&gt; %rax</div>
<div class="line">                               00 00 00 00</div>
<div class="line"> +40   m4 @0x0000000051765800                       &lt;label&gt;</div>
<div class="line"> +40   m4 @0x000000005171e070  65 48 89 0c 25 10 00 mov    %rcx -&gt; %gs:0x10[8byte]</div>
<div class="line">                               00 00</div>
<div class="line"> +49   m4 @0x0000000051765ad0  59                   pop    %rsp (%rsp)[8byte] -&gt; %rcx %rsp</div>
<div class="line"> +50   L4 @0x00000000517205f8  e9 fb 4a f9 ff       jmp    $0x00000000516af500 &lt;shared_bb_ibl_ret&gt;</div>
<div class="line">END 0x00007fbff7a2ccb2</div>
<div class="line"> </div>
<div class="line">Fragment 76, tag 0x00007fbff7a2ccb2, flags 0x1000030, shared, size 55:</div>
<div class="line"> </div>
<div class="line">  0x00000000516b7100  65 48 a3 18 00 00 00 mov    %rax -&gt; %gs:0x18[8byte]</div>
<div class="line">                      00 00 00 00</div>
<div class="line">  0x00000000516b710b  9f                   lahf    -&gt; %ah</div>
<div class="line">  0x00000000516b710c  0f 90 c0             seto    -&gt; %al</div>
<div class="line">  0x00000000516b710f  f0 81 05 8a c8 94 20 lock add    $0x00000001 &lt;rel&gt; 0x00000000720039a4[4byte] -&gt; &lt;rel&gt; 0x00000000720039a4[4byte]</div>
<div class="line">                      01 00 00 00</div>
<div class="line">  0x00000000516b711a  04 7f                add    $0x7f %al -&gt; %al</div>
<div class="line">  0x00000000516b711c  9e                   sahf   %ah</div>
<div class="line">  0x00000000516b711d  65 48 a1 18 00 00 00 mov    %gs:0x18[8byte] -&gt; %rax</div>
<div class="line">                      00 00 00 00</div>
<div class="line">  0x00000000516b7128  65 48 89 0c 25 10 00 mov    %rcx -&gt; %gs:0x10[8byte]</div>
<div class="line">                      00 00</div>
<div class="line">  0x00000000516b7131  59                   pop    %rsp (%rsp)[8byte] -&gt; %rcx %rsp</div>
<div class="line">  0x00000000516b7132  e9 c9 83 ff ff       jmp    $0x00000000516af500 &lt;shared_bb_ibl_ret&gt;</div>
<div class="line">  -------- exit stub 0: -------- &lt;target: 0x00000000516af500&gt; type: ret</div>
<div class="line">  &lt;no stub created since linked&gt;</div>
</div><!-- fragment --><p>The final listing is a disassembly of that fragment in the code cache. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:02:58 &nbsp; <img border=0 src="favicon.png">
</small></address>
