---
title: "Core Simulation Support"
layout: default
permalink: /sec_drcachesim_core.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Core Simulation Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>drcachesim</code> trace format includes information intended for use by core simulators as well as pure cache simulators. For traces that are not filtered by an online first-level cache, each data reference is preceded by the instruction fetch entry for the instruction that issued the data request. Additionally, on x86, string loop instructions involve a single insruction fetch followed by a loop of loads and/or stores. A <code>drcachesim</code> trace includes a special "no-fetch" instruction entry per iteration so that core simulators have the instruction information to go along with each load and store, while cache simulators can ignore these "no-fetch" entries and avoid incorrectly inflating instruction fetch statistics.</p>
<p>Traces include scheduling markers providing the timestamp and hardware thread identifier on each thread transition, allowing a simulator to more closely match the actual hardware if so desired.</p>
<p>Traces also include markers indicating disruptions in user mode control flow such as signal handler entry and exit.</p>
<p>Offline traces guarantee that a branch target instruction entry in a trace must immediately follow the branch instruction with no intervening thread switch. This allows a core simulator to identify the target of a branch by looking at the subsequent trace entry. This guarantee does not hold when a kernel event such as a signal is delivered immediately after a branch; however, each marker indicating such a kernel transfer includes the interrupted PC, explicitly providing the branch target.</p>
<p>Filtered traces (filtered via -L0_filter) include the dynamic (pre-filtered) per-thread instruction count in a <a class="el" href="trace__entry_8h.html#aa7f51b43d8f1e20dc45e3618684b15e9a94cc2db87863fcdcdf9163d8c9c2152e">TRACE_MARKER_TYPE_INSTRUCTION_COUNT</a> marker at each thread buffer boundary and at thread exit.</p>
<p>A final feature that aids core simulators is the pair of interfaces <a class="el" href="classmodule__mapper__t.html#a1cc0d9c7f1afc3316b0c7edbc6325178">module_mapper_t::get_loaded_modules()</a> and <a class="el" href="classmodule__mapper__t.html#add0cc122b72c75d519971cde9eeffd87">module_mapper_t::find_mapped_trace_address()</a>, which facilitate reading the raw bytes for each instruction in order to obtain the opcode and full operand information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:02:58 &nbsp; <img border=0 src="favicon.png">
</small></address>
