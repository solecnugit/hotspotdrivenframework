---
title: "_drreg_options_t Struct Reference"
layout: default
permalink: /struct__drreg__options__t.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">_drreg_options_t Struct Reference<div class="ingroups"><a class="el" href="group__drreg.html">Register Usage Coordinator</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;drreg.h&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a8bc71c47c70c0ac240cb6c75822f619d"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__drreg__options__t.html#a8bc71c47c70c0ac240cb6c75822f619d">struct_size</a></td></tr>
<tr class="separator:a8bc71c47c70c0ac240cb6c75822f619d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bbbd6b9f361d671cec4c6bd0142259d"><td class="memItemLeft" align="right" valign="top">uint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__drreg__options__t.html#a6bbbd6b9f361d671cec4c6bd0142259d">num_spill_slots</a></td></tr>
<tr class="separator:a6bbbd6b9f361d671cec4c6bd0142259d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f7789278b96170f6b9345c6bec730b8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__drreg__options__t.html#a3f7789278b96170f6b9345c6bec730b8">conservative</a></td></tr>
<tr class="separator:a3f7789278b96170f6b9345c6bec730b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a290ce7be16fe495f0c7bb521764e44"><td class="memItemLeft" align="right" valign="top">bool(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__drreg__options__t.html#a3a290ce7be16fe495f0c7bb521764e44">error_callback</a> )(<a class="el" href="group__drreg.html#gad5b7a7a020d7206b11e61e7cdae02ee9">drreg_status_t</a> status)</td></tr>
<tr class="separator:a3a290ce7be16fe495f0c7bb521764e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24b28e18148dfa38d91994024319ebe9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__drreg__options__t.html#a24b28e18148dfa38d91994024319ebe9">do_not_sum_slots</a></td></tr>
<tr class="separator:a24b28e18148dfa38d91994024319ebe9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Specifies the options when initializing drreg. </p>
</div><h2 class="groupheader">Field Documentation</h2>
<a id="a3f7789278b96170f6b9345c6bec730b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f7789278b96170f6b9345c6bec730b8">&#9670;&nbsp;</a></span>conservative</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool _drreg_options_t::conservative</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>By default, drreg assumes that the application will not rely on the particular value of a dead register when a fault happens. This allows drreg to reduce overhead. This flag can be set to request that drreg not make this assumption.</p>
<p>If multiple <a class="el" href="group__drreg.html#ga6656df86f1a73bdf739eedaba7220c46">drreg_init()</a> calls are made, this field is combined by logical OR.</p>
<p>XXX i#3801: If a fault occurs between two spills of a GPR or aflags, where the second spill is after an app write, the current drreg application state restoration logic does not restore the dead GPR/aflags even with this field set to true. It is difficult to do so without additional metadata passed to the state restoration callback. </p>

</div>
</div>
<a id="a24b28e18148dfa38d91994024319ebe9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24b28e18148dfa38d91994024319ebe9">&#9670;&nbsp;</a></span>do_not_sum_slots</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool _drreg_options_t::do_not_sum_slots</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Generally, library routines should take in scratch registers directly, keeping drreg reservations in the end client. However, sometimes this model is not sufficient, and a library wants to directly reserve drreg registers or aflags. The library can ensure that drreg is initialized, without forcing the client to do so when the client is not directly using drreg already, by calling <a class="el" href="group__drreg.html#ga6656df86f1a73bdf739eedaba7220c46">drreg_init()</a> and setting <code>do_not_sum_slots</code> to true. This ensures that the total requested slots is at least <code>num_spill_slots</code>, but if the total is already higher than that, the total is left alone.. Thus, if clients invoke <a class="el" href="group__drreg.html#ga6656df86f1a73bdf739eedaba7220c46">drreg_init()</a> on their own, the library will not needlessly add to the number of simultaneous slots needed. </p>

</div>
</div>
<a id="a3a290ce7be16fe495f0c7bb521764e44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a290ce7be16fe495f0c7bb521764e44">&#9670;&nbsp;</a></span>error_callback</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool(* _drreg_options_t::error_callback) (<a class="el" href="group__drreg.html#gad5b7a7a020d7206b11e61e7cdae02ee9">drreg_status_t</a> status)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Some drreg operations are performed during drmgr events where there is no direct return value to the user of drreg. When an error is encountered at these times, drreg will call this callback and pass the error value. If this callback is NULL, or if it returns false, drreg will call <a class="el" href="dr__tools_8h.html#a0f1fe81ae1737aa0e34eb69c855d359c">dr_abort()</a>.</p>
<p>If multiple <a class="el" href="group__drreg.html#ga6656df86f1a73bdf739eedaba7220c46">drreg_init()</a> calls are made, only the first callback is honored (thus, libraries generally should not set this). </p>

</div>
</div>
<a id="a6bbbd6b9f361d671cec4c6bd0142259d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bbbd6b9f361d671cec4c6bd0142259d">&#9670;&nbsp;</a></span>num_spill_slots</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint _drreg_options_t::num_spill_slots</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The number of TLS spill slots to use. This many slots will be requested from DR via <a class="el" href="dr__tools_8h.html#ac5d2a2ccd58268f84c379a38bc4aa399">dr_raw_tls_calloc()</a>. Any slots needed beyond this number will use DR's base slots, which are not allowed to be used across application instructions. DR's slots are also more expensive to access (beyond the first few). DR's base slots may also be used by APIs like <a class="el" href="dr__ir__utils_8h.html#ae8479716f08bbbb36d7fd27cfbbc0743">dr_save_reg()</a>/dr_restore_reg() (and the corresponding <a class="el" href="dr__ir__utils_8h.html#a6fdc15ea04e8d17fa537832acf274d9c">dr_read_saved_reg()</a>/dr_write_saved_reg()), which may cause correctness issues if there's some slot usage conflict within the same client or with other clients/libraries. Therefore, all cooperating client components should use drreg. Also, clients should make sure to request sufficient dedicated slots from drreg. This number should be computed as one plus the number of simultaneously used general-purpose register spill slots, as drreg reserves one of the requested slots for arithmetic flag preservation.</p>
<p>For each simultaneous value that will be held in a register across application instructions, an additional slot must be requested for adjusting the saved application value with respect to application reads and writes.</p>
<p>When <a class="el" href="group__drreg.html#ga6656df86f1a73bdf739eedaba7220c46">drreg_init()</a> is called multiple times, the number of slots is summed from each call, unless <code>do_not_sum_slots</code> is specified for that call, in which case a maximum is used rather than a sum. </p>

</div>
</div>
<a id="a8bc71c47c70c0ac240cb6c75822f619d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bc71c47c70c0ac240cb6c75822f619d">&#9670;&nbsp;</a></span>struct_size</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t _drreg_options_t::struct_size</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set this to the size of this structure. </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>/home/runner/work/dynamorio/dynamorio/ext/drreg/<a class="el" href="drreg_8h.html">drreg.h</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:02:58 &nbsp; <img border=0 src="favicon.png">
</small></address>
