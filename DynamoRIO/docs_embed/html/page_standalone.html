---
title: "Disassembly Library"
layout: default
permalink: /page_standalone.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Disassembly Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>DynamoRIO can be used as a standalone library for IA-32/AMD64/ARM/AArch64 disassembly, decoding, encoding, and general instruction manipulation, independently of controlling a target application. When used in this way, all aspects of DynamoRIO's API routines that apply to instrumentation or application control are not applicable; however, the full, rich instruction set API is enabled. For further information on the instruction set API see the following sections of the Code Manipulation API:</p>
<ul>
<li><a class="el" href="API_BT.html#sec_IR">Instruction Representation</a></li>
<li><a class="el" href="API_BT.html#sec_decode">Decoding and Encoding</a></li>
</ul>
<h1><a class="anchor" id="sec_standalone"></a>
Using DynamoRIO as a Standalone Library</h1>
<p>DynamoRIO can be used as a regular third-party library for a standalone application (instead of a client that operates on a target program). Two options are provided: using the regular DynamoRIO shared library, or using a special static library <code>drdecode</code>. The shared library provides not only decoding routines but also cross-platform resources such as file manipulation.</p>
<p>When using the DynamoRIO shared library, this initialization routine must be called prior to using any API routines:</p>
<div class="fragment"><div class="line"><a class="code" href="dr__tools_8h.html#a0917d634fe88c7d368eb6a20c17c55cb">dr_standalone_init</a>() </div>
</div><!-- fragment --><p>This routine returns a dummy context that can be passed to API routines.</p>
<p>When using <code>drdecode</code>, the special context <code>GLOBAL_DCONTEXT</code> should be used whenever a context is required. The <code>drdecode</code> library does not require initialization.</p>
<p>Neither the context returned by <a class="el" href="dr__tools_8h.html#a0917d634fe88c7d368eb6a20c17c55cb">dr_standalone_init()</a> nor <code>GLOBAL_DCONTEXT</code> can be used as the drcontext for a thread running under DynamoRIO control! It is only for standalone programs that wish to use DynamoRIO as a library of routines for instruction manipulation or other purposes.</p>
<p>In standalone mode, the <a class="el" href="dr__ir__encode_8h.html#ae796d2ff6eabe43904b17742deafd637">dr_set_isa_mode()</a> routine operates globally rather than per-thread.</p>
<p>Runtime options are ignored in standalone mode. Disassembly style can be controlled via <a class="el" href="dr__ir__disassemble_8h.html#ac5e34cc6c23ce496b13eebb043184552">disassemble_set_syntax()</a>. The processor to use will not be automatically set and will be assumed to be <code>VENDOR_INTEL</code>. Use <a class="el" href="dr__proc_8h.html#a79cc51e1a110888f10b93ce0278ed01e">proc_set_vendor()</a> to set to <code>VENDOR_AMD</code> instead.</p>
<p>In standalone mode, there are no 32-bit-displacement reachability guarantees regarding DynamoRIO's heap.</p>
<p>Some DynamoRIO API routines are not supported in standalone mode. These include all event registration routines, module iteration, <a class="el" href="dr__os__utils_8h.html#ae01c2ac2f3df4c23f2131ed2c367ac9b">dr_memory_protect()</a>, <a class="el" href="dr__tools_8h.html#ae52f61049269c0531b66b8c41c69e09e">dr_messagebox()</a>, <a class="el" href="dr__tools_8h.html#a317a1bb4c01ab9e6e64d2644d0ea984c">dr_get_current_drcontext()</a>, <a class="el" href="dr__tools_8h.html#a56eae1c5bac30a5336a99c5d91d5a10c">dr_get_thread_id()</a>, tls fields, <a class="el" href="dr__tools_8h.html#a100ea691259a4eff5419e7b34245703d">dr_thread_yield()</a>, <a class="el" href="dr__tools_8h.html#aac428021a331be838eca5a0ef19989bd">dr_sleep()</a>, client threads, suspending threads, itimers, register spilling and restoring, <a class="el" href="dr__ir__utils_8h.html#ac3aa7797e4e3ce2f741f99712bb704f5">dr_redirect_execution()</a>, try/except, and code cache routines (e.g., <a class="el" href="dr__tools_8h.html#a65e5ee30d5f4226445ce589f5b41b720">dr_delete_fragment()</a> or flush routines).</p>
<p>When using the <code>drdecode</code> library, no API routines other than those involving decoding, encoding, disassembling, instruction lists, instructions, or operands are supported. The various compute_address routines can be used by manually filling in <code>dr_mcontext_t</code>, although far memory references will have their segment base ignored. Other API routines are simply not present in the static library. There is no separate set of headers for use with <code>drdecode</code>.</p>
<p>When using DynamoRIO's CMake support, use the configure_DynamoRIO_decoder() function to set up include directories and to link with <code>drdecode</code>. The next section describes how to link with the DynamoRIO shared library.</p>
<h1><a class="anchor" id="sec_standalone_shared"></a>
DynamoRIO Shared Library Issues</h1>
<p>Since the DynamoRIO library on Windows includes or forwards implementations of certain C library routines (see <a class="el" href="using.html#subsec_forwards">C library utilities</a>), standalone applications linking to both DynamoRIO and the C library may experience linker errors when building and floating point problems when running. To avoid these problems, explicitly list the C runtime library on the command line:</p>
<div class="fragment"><div class="line">/link /nodefaultlib libcmt.lib dynamorio.lib </div>
</div><!-- fragment --><p>DynamoRIO writes to stderr and stdout using raw system calls, which can interfere with the buffering of library routines. When mixing use of printf or fprintf with DynamoRIO output (including not only <a class="el" href="dr__tools_8h.html#aeb88b22ff95c29ae793b9d84e1b95275">dr_printf()</a> and <a class="el" href="dr__tools_8h.html#ae338685a241cfeae5f3d507ae9cff957">dr_fprintf()</a> but also passing STDOUT or STDERR to routines like <a class="el" href="dr__ir__disassemble_8h.html#a4f2549391d161b1cee7d620efef7b9ff">disassemble()</a>), you may need to flush between library printing and DynamoRIO printing (e.g., using fflush(stdout)) to ensure that the library output is visible.</p>
<p>The binary tracedump reader (<a class="el" href="API_samples.html#sec_ex8">Use of Standalone API</a>) is an example of use of DynamoRIO as a standalone library.</p>
<p>When building an application that uses DynamoRIO as a standalone library, follow the steps for <a class="el" href="page_build_client.html">How to Build a Tool</a> to include the header files and link with the DynamoRIO library, but omit the linker flags requesting no standard libraries or startup files. DynamoRIO's CMake support does this automatically via the configure_DynamoRIO_standalone() function. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="adr__tools_8h_html_a0917d634fe88c7d368eb6a20c17c55cb"><div class="ttname"><a href="dr__tools_8h.html#a0917d634fe88c7d368eb6a20c17c55cb">dr_standalone_init</a></div><div class="ttdeci">DR_API void * dr_standalone_init(void)</div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:02:57 &nbsp; <img border=0 src="favicon.png">
</small></address>
