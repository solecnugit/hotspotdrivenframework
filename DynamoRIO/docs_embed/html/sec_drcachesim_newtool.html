---
title: "Creating New Analysis Tools"
layout: default
permalink: /sec_drcachesim_newtool.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Creating New Analysis Tools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>drcachesim</code> provides a <code>drmemtrace</code> analysis tool framework to make it easy to create new trace analysis tools. A new tool should subclass <a class="el" href="classanalysis__tool__t.html">analysis_tool_t</a>.</p>
<p>Concurrent processing of traces is supported by logically splitting a trace into "shards" which are each processed sequentially. The default shard is a traced application thread, but the tool interface can support other divisions. For tools that support concurrent processing of shards and do not need to see a single time-sorted interleaved merged trace, the interface functions with the parallel_ prefix should be overridden, and parallel_shard_supported() should return true. parallel_shard_init() will be invoked for each shard prior to invoking parallel_shard_memref() for each entry in that shard; the data structure returned from parallel_shard_init() will be passed to parallel_shard_memref() for each trace entry for that shard. The concurrency model used guarantees that all entries from any one shard are processed by the same single worker thread, so no synchronization is needed inside the parallel_ functions. A single worker thread invokes print_results() as well.</p>
<p>For serial operation, process_memref(), operates on a trace entry in a single, sorted, interleaved stream of trace entries. In the default mode of operation, the <a class="el" href="classanalyzer__t.html">analyzer_t</a> class iterates over the trace and calls the process_memref() function of each tool. An alternative mode is supported which exposes the iterator and allows a separate control infrastructure to be built. This alternative mode does not support parallel operation at this time.</p>
<p>Both parallel and serial operation can be supported by a tool, typically by having process_memref() create data on a newly seen traced thread and invoking parallel_shard_memref() to do its work.</p>
<p>For both parallel and serial operation, the function print_results() should be overridden. It is called just once after processing all trace data and it should present the results of the analysis. For parallel operation, any desired aggregation across the whole trace should occur here as well, while shard-specific results can be presented in parallel_shard_exit().</p>
<p>Today, parallel analysis is only supported for offline traces. Support for online traces may be added in the future.</p>
<p>In the default mode of operation, the <a class="el" href="classanalyzer__t.html">analyzer_t</a> class iterates over the trace and calls the appropriate <a class="el" href="classanalysis__tool__t.html">analysis_tool_t</a> functions for each tool. An alternative mode is supported which exposes the iterator and allows a separate control infrastructure to be built.</p>
<p>As explained in <a class="el" href="sec_drcachesim_format.html">Trace Format</a>, each trace entry is of type <a class="el" href="memref_8h.html#a5dc7702c7dece5c18bb576bf26d724b5">memref_t</a> and represents one instruction or data reference or a metadata operation such as a thread exit or marker. There are built-in scheduling markers providing the timestamp and cpu identifier on each thread transition. Other built-in markers indicate disruptions in user mode control flow such as signal handler entry and exit.</p>
<p>CMake support is provided for including the headers and linking the libraries of the <code>drmemtrace</code> framework. A new CMake function is defined in the DynamoRIO package which sets the include directory for using the <code>drmemtrace/</code> headers:</p>
<div class="fragment"><div class="line">use_DynamoRIO_drmemtrace(mytool)</div>
</div><!-- fragment --><p>The <code>drmemtrace_analyzer</code> library exported by the DynamoRIO package is the main library to link when building a new tool. The tools described above are also exported as the libraries <code>drmemtrace_basic_counts</code>, <code>drmemtrace_view</code>, <code>drmemtrace_opcode_mix</code>, <code>drmemtrace_histogram</code>, <code>drmemtrace_reuse_distance</code>, <code>drmemtrace_reuse_time</code>, <code>drmemtrace_simulator</code>, and <code>drmemtrace_func_view</code> and can be created using the <a class="el" href="basic__counts__create_8h.html#a5226888f7abaf6332c8f5b91d943d1ef">basic_counts_tool_create()</a>, <a class="el" href="opcode__mix__create_8h.html#a536fea86617ef6b1e2ec1205904ffe60">opcode_mix_tool_create()</a>, <a class="el" href="histogram__create_8h.html#ad7362677ef5655e034fdc1ce994842cb">histogram_tool_create()</a>, <a class="el" href="reuse__distance__create_8h.html#aa86cae7bab3e68a22c32dd9cc586a6f8">reuse_distance_tool_create()</a>, <a class="el" href="reuse__time__create_8h.html#a92d248f0be3b49715628424e5cf87ffb">reuse_time_tool_create()</a>, <a class="el" href="view__create_8h.html#a0eaa985b9e6cd69259a626518db79dca">view_tool_create()</a>, <a class="el" href="cache__simulator__create_8h.html#a4131299a08b18510acbea8a2772d914c">cache_simulator_create()</a>, <a class="el" href="tlb__simulator__create_8h.html#a95b0db93858738f814ccddb453ba1f53">tlb_simulator_create()</a>, and func_view_create() functions. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:02:58 &nbsp; <img border=0 src="favicon.png">
</small></address>
