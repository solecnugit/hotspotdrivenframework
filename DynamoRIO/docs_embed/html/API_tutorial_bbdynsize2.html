---
title: "average_bb_size.p2"
layout: default
permalink: /API_tutorial_bbdynsize2.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">average_bb_size.p2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Now we register for events we'll need. For our first pass we only need to register for the bb event (to add our instrumentation) and the exit event (to display the results). We don't need to register for trace events (as we will add our instrumentation to the constituent bbs) and we can ignore the <code>for_trace</code> and <code>translating</code> arguments to the basic block callback as our changes are deterministic and idempotent so DynamoRIO default translation will work fine.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dr__api_8h.html">dr_api.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">+ <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">+ event_exit(<span class="keywordtype">void</span>);</div>
<div class="line">+ <span class="keyword">static</span> <a class="code" href="dr__events_8h.html#a689518ac5d1ad136b13e03012702b209">dr_emit_flags_t</a></div>
<div class="line">+ event_basic_block(<span class="keywordtype">void</span> *drcontext, <span class="keywordtype">void</span> *tag, <a class="code" href="dr__defines_8h.html#a3fb73c55def575ec5705577625491d66">instrlist_t</a> *bb,</div>
<div class="line">+                   <span class="keywordtype">bool</span> for_trace, <span class="keywordtype">bool</span> translating);</div>
<div class="line"> </div>
<div class="line">DR_EXPORT <span class="keywordtype">void</span></div>
<div class="line"><a class="code" href="dr__api_8h.html#a2b938c98dd186cc94eef6880f9e3c3e9">dr_client_main</a>(<a class="code" href="dr__defines_8h.html#a68540a70b4f8150a4fe6dcec91bf8825">client_id_t</a> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">+     <span class="comment">/* register events */</span></div>
<div class="line">+     <a class="code" href="dr__events_8h.html#a32f38cabf4b2c554ce4e476c5d5f6f3a">dr_register_exit_event</a>(event_exit);</div>
<div class="line">+     <a class="code" href="dr__events_8h.html#acbfe1ece2c520d409ffd59076507a710">dr_register_bb_event</a>(event_basic_block);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">+ <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">+ event_exit(<span class="keywordtype">void</span>)</div>
<div class="line">+ {</div>
<div class="line">+     <span class="comment">/* empty */</span></div>
<div class="line">+ }</div>
<div class="line">+</div>
<div class="line">+ <span class="keyword">static</span> <a class="code" href="dr__events_8h.html#a689518ac5d1ad136b13e03012702b209">dr_emit_flags_t</a></div>
<div class="line">+ event_basic_block(<span class="keywordtype">void</span> *drcontext, <span class="keywordtype">void</span> *tag, <a class="code" href="dr__defines_8h.html#a3fb73c55def575ec5705577625491d66">instrlist_t</a> *bb,</div>
<div class="line">+                   <span class="keywordtype">bool</span> for_trace, <span class="keywordtype">bool</span> translating)</div>
<div class="line">+ {</div>
<div class="line">+     <span class="comment">/* empty */</span></div>
<div class="line">+     <span class="keywordflow">return</span> <a class="code" href="dr__events_8h.html#a689518ac5d1ad136b13e03012702b209a7d25c4546544d1a8c0b77c69230772eb">DR_EMIT_DEFAULT</a>;</div>
<div class="line">+ }</div>
</div><!-- fragment --><p>[ <a class="el" href="API_tutorial_bbdynsize1.html">prev</a> | <a class="el" href="API_tutorial_bbdynsize3.html">next</a> ] </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="adr__api_8h_html"><div class="ttname"><a href="dr__api_8h.html">dr_api.h</a></div><div class="ttdoc">Top-level include file for DynamoRIO API.</div></div>
<div class="ttc" id="adr__api_8h_html_a2b938c98dd186cc94eef6880f9e3c3e9"><div class="ttname"><a href="dr__api_8h.html#a2b938c98dd186cc94eef6880f9e3c3e9">dr_client_main</a></div><div class="ttdeci">DR_EXPORT void dr_client_main(client_id_t id, int argc, const char *argv[])</div></div>
<div class="ttc" id="adr__events_8h_html_a689518ac5d1ad136b13e03012702b209"><div class="ttname"><a href="dr__events_8h.html#a689518ac5d1ad136b13e03012702b209">dr_emit_flags_t</a></div><div class="ttdeci">dr_emit_flags_t</div><div class="ttdef"><b>Definition:</b> dr_events.h:82</div></div>
<div class="ttc" id="adr__defines_8h_html_a3fb73c55def575ec5705577625491d66"><div class="ttname"><a href="dr__defines_8h.html#a3fb73c55def575ec5705577625491d66">instrlist_t</a></div><div class="ttdeci">struct _instrlist_t instrlist_t</div><div class="ttdef"><b>Definition:</b> dr_defines.h:788</div></div>
<div class="ttc" id="adr__events_8h_html_acbfe1ece2c520d409ffd59076507a710"><div class="ttname"><a href="dr__events_8h.html#acbfe1ece2c520d409ffd59076507a710">dr_register_bb_event</a></div><div class="ttdeci">DR_API void dr_register_bb_event(dr_emit_flags_t(*func)(void *drcontext, void *tag, instrlist_t *bb, bool for_trace, bool translating))</div></div>
<div class="ttc" id="adr__events_8h_html_a32f38cabf4b2c554ce4e476c5d5f6f3a"><div class="ttname"><a href="dr__events_8h.html#a32f38cabf4b2c554ce4e476c5d5f6f3a">dr_register_exit_event</a></div><div class="ttdeci">DR_API void dr_register_exit_event(void(*func)(void))</div></div>
<div class="ttc" id="adr__events_8h_html_a689518ac5d1ad136b13e03012702b209a7d25c4546544d1a8c0b77c69230772eb"><div class="ttname"><a href="dr__events_8h.html#a689518ac5d1ad136b13e03012702b209a7d25c4546544d1a8c0b77c69230772eb">DR_EMIT_DEFAULT</a></div><div class="ttdeci">@ DR_EMIT_DEFAULT</div><div class="ttdef"><b>Definition:</b> dr_events.h:84</div></div>
<div class="ttc" id="adr__defines_8h_html_a68540a70b4f8150a4fe6dcec91bf8825"><div class="ttname"><a href="dr__defines_8h.html#a68540a70b4f8150a4fe6dcec91bf8825">client_id_t</a></div><div class="ttdeci">uint client_id_t</div><div class="ttdef"><b>Definition:</b> dr_defines.h:350</div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:02:58 &nbsp; <img border=0 src="favicon.png">
</small></address>
