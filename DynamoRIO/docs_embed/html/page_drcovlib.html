---
title: "Code Coverage Library"
layout: default
permalink: /page_drcovlib.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Code Coverage Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>drcovlib</code> is a DynamoRIO Extension that collects code coverage information. If you are looking for an end-user tool, the DynamoRIO tool <a class="el" href="page_drcov.html">Code Coverage Tool</a> combined with the post-processing tool <a class="el" href="page_drcov.html#sec_drcov2lcov">Post-Processing</a> should be used instead of this library. <code>drcovlib</code> is intended to be used to add coverage information to other tools. The <code>drcov</code> client itself makes use of <code>drcovlib</code>.</p>
<ul>
<li><a class="el" href="page_drcovlib.html#sec_drcovlib">The Code Coverage Interface</a></li>
<li><a class="el" href="page_drcovlib.html#sec_elision">Elision Not Supported</a></li>
<li><a class="el" href="page_drcovlib.html#sec_postproc">Post-Processing</a></li>
<li><a class="el" href="page_drcovlib.html#sec_modtrack">Module Tracking Feature</a></li>
</ul>
<h1><a class="anchor" id="sec_drcovlib"></a>
The Code Coverage Interface</h1>
<p>The <code>drcovlib</code> library's basic operation is to capture coverage information during execution and write the results to a single log file for the whole at the end of execution. Per-thread coverage information can be obtained by running DynamoRIO with thread-private code caches and passing the <a class="el" href="group__drcovlib.html#gga4e8b8bfb2b8edf258fa3ccfe99de5b35a2d177716bc8797ec53a7f85604d9271c">DRCOVLIB_THREAD_PRIVATE</a> flag to <a class="el" href="group__drcovlib.html#gaf677d6ab6dbb234a71366b8bc9fafa2e">drcovlib_init()</a>.</p>
<p>Coverage information is finalized to the log file when <a class="el" href="group__drcovlib.html#ga9ae4cea2825fc79abec8b6c0c87855d9">drcovlib_exit()</a> is called (or for <a class="el" href="group__drcovlib.html#gga4e8b8bfb2b8edf258fa3ccfe99de5b35a2d177716bc8797ec53a7f85604d9271c">DRCOVLIB_THREAD_PRIVATE</a> when <code>drcovlib's</code> own thread exit events are invoked by DynamoRIO). For processes that are terminated without a chance for a clean exit by their parents, the caller may want to consider using <a class="el" href="group__drx.html#ga9348e840424caf0098a8b1ba69955864">drx_register_soft_kills()</a> with a soft kill callback that nudges the child process and a nudge event callback that invokes <a class="el" href="dr__tools_8h.html#aec4ac39e59bdcec70223794387db9fd0">dr_exit_process()</a>. This will ensure that log file are written out. If this is not sufficient, <a class="el" href="group__drcovlib.html#ga950d622b84e132eec3efbdd63bde8d1e">drcovlib_dump()</a> is provided, though it should not be called when normal dumping will occur.</p>
<h1><a class="anchor" id="sec_elision"></a>
Elision Not Supported</h1>
<p>The DynamoRIO runtime options -max_elide_jmp and -max_elide_call must be left at their default values of zero. <code>drcovlib</code> does not support setting them to non-zero values.</p>
<h1><a class="anchor" id="sec_postproc"></a>
Post-Processing</h1>
<p>To post-process <code>drcovlib's</code> log files and create human-readable output, see instructinons for running the <code>drcov2lcov</code> utility: <a class="el" href="page_drcov.html#sec_drcov2lcov">Post-Processing</a>.</p>
<h1><a class="anchor" id="sec_modtrack"></a>
Module Tracking Feature</h1>
<p>In addition to code coverage, <code>drcovlib</code> provides a module (library) tracking feature that is useful for using an index and an offset as a persistent representation of the location of an application program counter for later symbolization. This feature handles unloaded and reloaded libraries and offers fast lookup. The module information can be written to a file and read back in either online or offline using DR's standalone API via the drmodtrack_offline_* interface. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:02:58 &nbsp; <img border=0 src="favicon.png">
</small></address>
